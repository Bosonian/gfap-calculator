
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>ICH Probability Calculator</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 30px; }
        label { margin-right: 10px; }
        input { width: 80px; margin-right: 20px; }
        #result { margin-top: 20px; font-size: 1.2em; color: darkred; }
    </style>
</head>
<body>

<h3>ICH Probability Calculator</h3>

<label for="age">Age:</label>
<input type="number" id="age" value="75" min="1" max="120">
<label for="bp">Systolic BP:</label>
<input type="number" id="bp" value="180" min="50" max="300">
<label for="gfap">GFAP (pg/mL):</label>
<input type="number" id="gfap" value="1200" min="1" max="10000">

<button onclick="calculateAndShow()">Calculate</button>

<div id="result"></div>

<hr>
<h3>ICH Probability vs GFAP (Dynamic Curve)</h3>
<div id="plot"></div>

<script>
// Logistic regression function using log10(GFAP)
function calculateICHProbability(age, systolicBP, gfap) {
    if (gfap <= 0) return 0;
    const intercept = -9.4520;
    const coef_age = -0.0504;
    const coef_bp = 0.0168;
    const coef_loggfap = 4.8941;
    const logGFAP = Math.log10(gfap);
    const logit = intercept + coef_age * age + coef_bp * systolicBP + coef_loggfap * logGFAP;
    return 1 / (1 + Math.exp(-logit));
}

// Show calculated probability
function calculateAndShow() {
    const age = parseFloat(document.getElementById('age').value);
    const bp = parseFloat(document.getElementById('bp').value);
    const gfap = parseFloat(document.getElementById('gfap').value);
    const prob = calculateICHProbability(age, bp, gfap);
    document.getElementById('result').innerHTML =
        `Probability of ICH: <b>${(prob * 100).toFixed(2)}%</b>`;
    drawPlot(age, bp);
}

// Draw dynamic plot for the current age/bp
function drawPlot(age, bp) {
    const gfap_values = [];
    const ich_probabilities = [];
    for (let gfap = 1; gfap <= 5000; gfap += 50) {
        gfap_values.push(gfap);
        ich_probabilities.push(calculateICHProbability(age, bp, gfap));
    }
    Plotly.newPlot('plot', [{
        x: gfap_values,
        y: ich_probabilities,
        type: 'scatter',
        mode: 'lines',
        line: {color: 'red'},
        name: 'ICH Probability'
    }], {
        title: `Probability of ICH vs GFAP (Age ${age}, BP ${bp})`,
        xaxis: { title: 'GFAP (pg/mL)', range: [0, 5000] },
        yaxis: { title: 'Probability of ICH', range: [0, 1] },
        margin: { t: 50 }
    });
}

// Draw initial plot
drawPlot(75, 180);
</script>

</body>
</html>
